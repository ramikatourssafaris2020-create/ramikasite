<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" href="img/logo.png" type="image/png">
      <title>Ramika Safaris & Tours</title>
      <!-- Bootstrap css -->
      <link rel="stylesheet" href="vender/bootstrap/css/bootstrap.min.css">
      <link rel="stylesheet" href="font/bootstrap-icons.css">
   <!-- Custom css -->
   <link rel="stylesheet" href="css/style.css">
   <!-- Slider css -->
    <STYLE>
      .lazy-bg {
  filter: blur(10px);
  transition: filter 0.6s ease-out;
}

.lazy-bg.loaded {
  filter: blur(0);
}

    </STYLE>
   <link rel="stylesheet" href="css/slider.css">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;700&display=swap" rel="stylesheet">
   </head>
   <body>
      <!-- Status Bar (mimics mobile device status bar) -->
      <div class="status-bar">
         <div><a href="admin.html" style="color: white;">Catch up the upcoming tour [Mpanga Kipengele on 15/12/25]</a></div>
         <div>
            <i class="bi bi-arrow-right ms-2"></i>
         </div>
      </div>
   
      <!-- Overlay -->
      <div class="overlay" id="overlay"></div>
      <!-- App Header -->
      <div class="app-header d-flex justify-content-between align-items-center">
         <div class="d-flex align-items-center">
            <button id="menuBtn" class="btn menu-btn">
            <i class="bi bi-three-dots-vertical menu-icon"></i>
            </button>
            <div class="d-flex align-items-center">
               <img src="logo.png" height="50">              
            </div>
         </div>
         <div class="d-flex align-items-center">
            <a href="search.html" class="btn header-btn me-2">
            <i class="bi bi-search icon-md"></i>
            </a>&nbsp;
            <a href="notifications.html" class="btn header-btn me-2">
            <i class="bi bi-bell icon-md"></i>
            </a>&nbsp;
            <a id="logoutBtn"  class="btn header-btn me-2" style="border: 1px solid #00000049;border-radius: 50%;padding: 1px 0">
            <img src="logo.png" height="30">
            </a>&nbsp;
            <a id="logoutBtn" class="btn header-btn me-2">
            <i class="bi bi-box-arrow-right icon-md"></i>
            </a>&nbsp;
         </div>
      </div>
      <!-- Main Content Area -->
      <div class="content-area">
<div class="hero" style="background-image: linear-gradient(rgba(0, 0, 0, 0.349), rgba(0,0,0,0.45)), url('maua.JPG');">
  <div class="content">
    <h1>Welcome to Ramika Safaris</h1>
    <p>A local tour super agent company discovering your next safari <br> in the southern highlands of Tanzania.</p>
  </div>
</div>

         <!-- Search Section -->
         <div class="search-card">
            <h6 class="text-primary-color mb-3 fw-semibold">
               <i class="bi bi-bookmark-fill me-2"></i>Book available tours
            </h6>
            <form id="bookingForm">
            <div class="mb-3">
               <label for="email" class="form-label">Name</label>
               <div class="input-group">
                  <span class="input-group-text bg-primary border-end-0">
                  <i class="bi bi-person text-white"></i>
                  </span>
                  <input type="text" style=" border: 1px solid #5251513b;" class="form-control border-start-0" id="full_name" placeholder="Enter your name">
               </div>
            </div>
            <div class="mb-3">
               <label for="email" class="form-label">Email</label>
               <div class="input-group">
                  <span class="input-group-text bg-primary border-end-0">
                  <i class="bi bi-envelope text-white"></i>
                  </span>
                  <input type="email" style=" border: 1px solid #5251513b;" class="form-control border-start-0" id="email" placeholder="Enter your email">
               </div>
            </div>
            <div class="mb-3">
               <label for="email" class="form-label">Phone number</label>
               <div class="input-group">
                  <span class="input-group-text bg-primary border-end-0">
                  <i class="bi bi-phone text-white"></i>
                  </span>
                  <input type="number" style=" border: 1px solid #5251513b;" class="form-control border-start-0" id="phone" placeholder="Enter active phone number">
               </div>
            </div>
            <div class="form-check mb-3">
                <label class="form-check-label" for="bookForOthers" style="color: rgb(7, 98, 151);">
               This will be your next default informations
               </label>
            </div>
   
               <div class="mb-3">
                  <label for="fromLocation" class="form-label">
                  <i class="bi bi-geo-alt me-1 text-primary-color"></i>Available tours
                  </label>
                  <select class="form-select" id="tourSelect">
                  <option value="selected">Select a Tour</option>
                  </select>
               </div>
               <div class="mb-3">
                  <label for="travelDate" class="form-label">
                  <i class="bi bi-calendar3 me-1 text-accent-color"></i>Date of Visit
                  </label>
                  <input type="date" class="form-control" id="tour_date">
               </div>
               <button type="submit" class="btn-app p-2  btn">
               Submit 
               </button>
            </form>
         </div>


         
<div id="bookedTours">
  <h3>Your Booked Tours</h3>
  <div id="userBookings">No booked tours yet.</div>
</div>

<div id="notificationsContainer">
  <h3>Your Notifications</h3>
  <div id="notifications">No notifications yet.</div>
</div>
<div class="wrapper-hero">         
<div class="hero-2 lazy-bg" 
     data-bg="mpanga.jpg"
     style="
       background-image: linear-gradient(rgba(0, 0, 0, 0.507), rgba(0, 0, 0, 0.616)), url('tiny-blur.jpg');
       background-size: cover;
       background-position: center;
       background-repeat: no-repeat;
       height: 30vh;">
  <div class="content">
    <h1>Visit Mpanga Kipengere</h1>
    <p>Discovering your next safari WITHIN Mpanga kipengere <br> inside Makambako Tanzania</p>
    <a href="mpanga.html">
      <span class="btn btn-light btn-sm" style="font-weight: 600; border: none; background-color: #fff;">
        Check full details
      </span>
    </a>  
  </div>
</div>

</div>
<div class="wrapper-hero"> 
<div class="hero-2 lazy-bg" 
     data-bg="kitulo.JPG"
     style="
       background-image: linear-gradient(rgba(0, 0, 0, 0.507), rgba(0, 0, 0, 0.616)), url('tiny-blur.jpg');
       background-size: cover;
       background-position: center;
       background-repeat: no-repeat;
       height: 30vh;">
  <div class="content">
    <h1>Visit Kitulo National Park
    </h1>
    <p>View a beautiful land of with flowers located in <br> Njombe Tanzania</p>
<a href="mpanga.html"><span class="btn btn-light btn-sm" style="font-weight: 600; border: none;background-color: rgb(255, 255, 255);">
                Check full details 
             </span></a>  
   </div>
</div>
</div>
         <!-- Recent Searches -->
         <h6 class="section-header">Popular bookings</h6>
         <a href="tour-details.html" class="route-card d-block">
            <div class="d-flex justify-content-between align-items-center">
               <div>
                  <div class="d-flex align-items-center">
                     <span class="fw-semibold text-primary-color">Kitulo National park</span>
                     <i class="bi bi-arrow-right mx-2 text-secondary-color"></i>
                     <span class="fw-semibold text-primary-color">Njombe, Tanzania</span>
                  </div>
                  <div class="d-flex align-items-center mt-2">
                     <i class="bi bi-calendar3 me-2 fs-12 text-secondary-color"></i>
                     <span class="text-muted small"> Last tour - Apr 15, 2025</span>
                  </div>
               </div>
               <span class="btn btn-light btn-sm" style="border: 1px solid rgba(206, 201, 201, 0.603);">
                   <i class="bi bi-search"></i> Check availability
             </span>
            </div>
         </a>
         <a href="tour-details.html" class="route-card d-block">
            <div class="d-flex justify-content-between align-items-center">
               <div>
                  <div class="d-flex align-items-center">
                     <span class="fw-semibold text-primary-color">Mpanga Kipengele</span>
                     <i class="bi bi-arrow-right mx-2 text-secondary-color"></i>
                     <span class="fw-semibold text-primary-color">Makambako, Njombe</span>
                  </div>
                  <div class="d-flex align-items-center mt-2">
                     <i class="bi bi-calendar3 me-2 fs-12 text-secondary-color"></i>
                     <span class="text-muted small">Last tour - Apr 10, 2025</span>
                  </div>
               </div>
               <div class="btn btn-light btn-sm" style="border: 1px solid rgba(206, 201, 201, 0.603);">
                  <i class="bi bi-search"></i> Check availability
               </div>
            </div>
         </a>
         <!-- Special Offers -->
         <h6 class="section-header">Special Offers</h6>
         <a href="offers-rewards.html" class="offer-card d-block"  style="border: 1px solid rgba(206, 201, 201, 0.603);">
            <span class="offer-badge">20% OFF</span>
            <div class="d-flex align-items-center">
               <div class="icon-50 d-flex align-items-center justify-content-center rounded-3 gradient-1">
                  <i class="bi bi-ticket-perforated text-white fs-24"></i>
               </div>
               <div class="ms-3">
                  <div class="fw-semibold text-primary-color">Weekend Special</div>
                  <div class="text-muted small">20% off on all weekend trips</div>
                  <div class="mt-1 text-accent-color fs-11">
                     <i class="bi bi-clock-history me-1"></i>Valid until Apr 30
                  </div>
               </div>
            </div>
         </a>
         <a href="offers-rewards.html" class="offer-card d-block mb-4"  style="border: 1px solid rgba(206, 201, 201, 0.603);">
            <span class="offer-badge">$10 OFF</span>
            <div class="d-flex align-items-center">
               <div class="icon-50 d-flex align-items-center justify-content-center rounded-3 gradient-2">
                  <i class="bi bi-gift text-white fs-24"></i>
               </div>
               <div class="ms-3">
                  <div class="fw-semibold text-primary-color">First Trip Discount</div>
                  <div class="text-muted small">$10 off on your first booking</div>
                  <div class="mt-1 text-accent-color fs-11">
                     <i class="bi bi-person-plus me-1"></i>New users only
                  </div>
               </div>
            </div>
         </a>
           <!-- Upcoming Trips -->
            <h6 class="section-header mt-0">Upcoming Tours</h6>
         <div class="list-item" style="border: 1px solid rgba(206, 201, 201, 0.603); margin: 15px;">
               <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                     <div class="d-flex align-items-center">
                        <span class="fw-semibold text-primary-color">Mpanga Kipengere</span>
                        <i class="bi bi-arrow-right mx-2 text-secondary-color"></i>
                        <span class="fw-semibold text-primary-color">Makambako, Tanzania</span>
                     </div>
                  </div>
                  <span class="status-badge confirmed">Confirmed</span>
               </div>
               <div class="d-flex justify-content-between mb-3">
                  <div class="d-flex align-items-center">
                     <i class="bi bi-calendar3 me-2 text-secondary-color fs-14"></i>
                     <span class="text-muted">Dec 15, 2025</span>
                  </div>
                  <div class="d-flex align-items-center">
                     <i class="bi bi-clock me-2 text-secondary-color fs-14"></i>
                     <span class="text-muted">From 10:30 AM</span>
                  </div>
               </div>
               <div class="d-flex justify-content-between align-items-center">
                  <div>
                     <div class="fw-semibold">Booking #BG78945</div>
                     <div class="small text-muted">Login to check goings</div>
                  </div>
                  <a href="my-tickets.html" class=" fs-14 rounded-3 bg-primary-color text-white" style="padding: 8px;">
                  View Ticket
                  </a>
               </div>
            </div> 

<!-- Add this div where you want the tour cards to display -->
<div id="tourCards"></div>




      </div>
      <!-- Bottom Navigation Bar (App-style) -->
      <div class="bottom-nav">
         <a href="index.html" class="nav-item active">
         <i class="bi bi-house-door-fill"></i>
         <span>Home</span>
         </a>
         <a href="search.html" class="nav-item">
         <i class="bi bi-search"></i>
         <span>Search</span>
         </a>
         <a href="tour-details.html" class="nav-item btn rounded-4" style="color: white;background-color: black;">
         <i class="bi bi-ticket-perforated"></i>
          <span>Bookings</span>
         </a>
         <a href="offers-rewards.html" class="nav-item">
         <i class="bi bi-gift"></i>
         <span>Offers</span>
         </a>
         <a href="settings.html" class="nav-item">
         <i class="bi bi-person"></i>
         <span>Profile</span>
         </a>
      </div>
      <!-- Bootstrap bundle js -->
         <script src="vender/bootstrap/js/bootstrap.bundle.min.js" type="d3207339c2170cba09c6aadb-text/javascript"></script>
         <!-- Script js -->
         <script src="js/script.js" type="d3207339c2170cba09c6aadb-text/javascript"></script>
         <script src="js/slider.js"></script>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = "https://tmqxjnegtiuircaxqkof.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtcXhqbmVndGl1aXJjYXhxa29mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMTIwNTEsImV4cCI6MjA3Mjg4ODA1MX0.Mx-7VrVhR5kxiKwpuBVHyKy1LO278Z3EbcAqWLXX8Yk";
const supabase = createClient(supabaseUrl, supabaseKey);

const tourSelect = document.getElementById("tourSelect");
const bookingForm = document.getElementById("bookingForm");
const emailInput = document.getElementById("email");
const userBookingsDiv = document.getElementById("userBookings");
const notificationsDiv = document.getElementById("notifications");
const tourCardsContainer = document.getElementById("tourCards"); // Add this container to your HTML

let lastEmail = '';
let toursData = []; // Store tours data globally

// Load tours
async function loadTours() {
  const { data, error } = await supabase.from('activities')
    .select('id, name, price, description, duration, location, image_url')
    .order('created_at', { ascending: true });
  
  if (error) return console.error('Load tours error:', error);

  toursData = data; // Store for global access
  
  // Populate dropdown
  tourSelect.innerHTML = '<option value="">Select a Tour</option>';
  data.forEach(t => {
    const option = document.createElement('option');
    option.value = t.name;
    option.textContent = `${t.name} (${t.price ? '$'+t.price : 'Free'})`;
    tourSelect.appendChild(option);
  });

  // Create tour cards
  createTourCards(data);
}

// Create tour cards
function createTourCards(tours) {
  if (!tourCardsContainer) {
    console.warn('Tour cards container not found. Add <div id="tourCards"></div> to your HTML');
    return;
  }

  tourCardsContainer.innerHTML = '';
  
  tours.forEach(tour => {
    const card = document.createElement('div');
    card.className = 'tour-card';
    card.innerHTML = `
      <div class="tour-card-image">
        <img src="${tour.image_url || 'https://via.placeholder.com/300x200?text=Tour+Image'}" 
             alt="${tour.name}" 
             onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
      </div>
      <div class="tour-card-content">
        <h3 class="tour-title">${tour.name}</h3>
        <p class="tour-description">${tour.description || 'Experience an amazing adventure!'}</p>
        <div class="tour-details">
          ${tour.duration ? `<span class="tour-duration">⏱️ ${tour.duration}</span>` : ''}
          ${tour.location ? `<span class="tour-location">📍 ${tour.location}</span>` : ''}
        </div>
        <div class="tour-footer">
          <span class="tour-price">${tour.price ? '$' + tour.price : 'Free'}</span>
          <button class="select-tour-btn" onclick="selectTour('${tour.name}')">
            Select Tour
          </button>
        </div>
      </div>
    `;
    tourCardsContainer.appendChild(card);
  });
}

// Function to select tour from card
window.selectTour = function(tourName) {
  tourSelect.value = tourName;
  tourSelect.dispatchEvent(new Event('change'));
  
  // Scroll to booking form
  bookingForm.scrollIntoView({ behavior: 'smooth' });
  
  // Highlight selected tour
  document.querySelectorAll('.tour-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  // Find and highlight the selected card
  const selectedCard = Array.from(document.querySelectorAll('.tour-card')).find(card => 
    card.querySelector('.tour-title').textContent === tourName
  );
  if (selectedCard) {
    selectedCard.classList.add('selected');
  }
}

// Load user bookings and notifications in parallel
async function loadUserData(email) {
  if (!email) {
    userBookingsDiv.innerHTML = "No booked tours yet.";
    notificationsDiv.innerHTML = "No notifications yet.";
    return;
  }

  const [bookingsRes, notificationsRes] = await Promise.all([
    supabase.from('bookings')
      .select('tour_name, tour_date')
      .eq('email', email)
      .order('created_at', { ascending: false })
      .limit(20),

    supabase.from('notifications')
      .select('message')
      .eq('user_email', email)
      .order('created_at', { ascending: false })
      .limit(20)
  ]);

  // Render bookings
  const bookings = bookingsRes.data || [];
  userBookingsDiv.innerHTML = bookings.length
    ? bookings.map(b => `<div class="booked-tour"><span>${b.tour_name}</span><small>${b.tour_date}</small></div>`).join('')
    : "No booked tours yet.";

  // Render notifications
  const notifications = notificationsRes.data || [];
  notificationsDiv.innerHTML = notifications.length
    ? notifications.map(n => `<p>📣 ${n.message}</p>`).join('')
    : "No notifications yet.";
}

// Booking submit
bookingForm.addEventListener('submit', async e => {
  e.preventDefault();
  const booking = {
    full_name: document.getElementById("full_name").value,
    email: emailInput.value.trim(),
    phone: document.getElementById("phone").value,
    tour_name: tourSelect.value,
    tour_date: document.getElementById("tour_date").value,
    notes: ""
  };

  if (!booking.tour_name) return alert('Select a tour');

  // Check duplicate booking
  const { data: existing } = await supabase.from('bookings')
    .select('id')
    .eq('email', booking.email)
    .eq('tour_name', booking.tour_name)
    .limit(1);

  if (existing.length) return alert('You already booked this tour!');

  const { error } = await supabase.from('bookings').insert([booking]);
  if (error) return alert('Booking failed: ' + error.message);

  alert('Booking successful!');
  bookingForm.reset();
  
  // Clear tour selection
  document.querySelectorAll('.tour-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  loadUserData(booking.email);
});

// Reload bookings/notifications only if email changed
emailInput.addEventListener('blur', () => {
  const email = emailInput.value.trim();
  if (email && email !== lastEmail) {
    lastEmail = email;
    loadUserData(email);
  }
});

// Initial load
loadTours();
</script>

<style>
/* Tour Cards Styles */
#tourCards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.tour-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.tour-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.tour-card.selected {
  border-color: #007bff;
  box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
}

.tour-card-image {
  height: 200px;
  overflow: hidden;
}

.tour-card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.tour-card:hover .tour-card-image img {
  transform: scale(1.05);
}

.tour-card-content {
  padding: 20px;
}

.tour-title {
  font-size: 1.5em;
  font-weight: bold;
  margin: 0 0 10px 0;
  color: #333;
}

.tour-description {
  color: #666;
  line-height: 1.5;
  margin: 0 0 15px 0;
}

.tour-details {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin: 15px 0;
}

.tour-duration,
.tour-location {
  background: #f8f9fa;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 0.9em;
  color: #555;
}

.tour-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}

.tour-price {
  font-size: 1.5em;
  font-weight: bold;
  color: #28a745;
}

.select-tour-btn {
  background: #007bff;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 25px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s ease;
}

.select-tour-btn:hover {
  background: #0056b3;
}

.tour-card.selected .select-tour-btn {
  background: #28a745;
}

.tour-card.selected .select-tour-btn:hover {
  background: #1e7e34;
}

/* Responsive design */
@media (max-width: 768px) {
  #tourCards {
    grid-template-columns: 1fr;
  }
  
  .tour-footer {
    flex-direction: column;
    gap: 10px;
  }
  
  .select-tour-btn {
    width: 100%;
  }
}
</style>


  <script>
document.addEventListener("DOMContentLoaded", () => {
  const lazySections = document.querySelectorAll(".lazy-bg");

  const observer = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const section = entry.target;
        const bgUrl = section.dataset.bg;

        // Apply the real background image on top of gradient
        section.style.backgroundImage = `
          linear-gradient(rgba(0, 0, 0, 0.507), rgba(0, 0, 0, 0.616)),
          url('${bgUrl}')
        `;

        section.classList.add("loaded");
        observer.unobserve(section);
      }
    });
  });

  lazySections.forEach(section => observer.observe(section));
});
</script>
</body>
</html>
